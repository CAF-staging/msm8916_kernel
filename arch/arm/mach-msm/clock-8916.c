/* Copyright (c) 2013, The Linux Foundation. All rights reserved.
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License version 2 and
 * only version 2 as published by the Free Software Foundation.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 */

#include <linux/kernel.h>
#include <linux/init.h>
#include <linux/err.h>
#include <linux/ctype.h>
#include <linux/io.h>
#include <linux/spinlock.h>
#include <linux/delay.h>
#include <linux/clk.h>
#include <linux/iopoll.h>
#include <linux/clk/msm-clock-generic.h>

#include <mach/socinfo.h>

#include "clock.h"

/*
 * Drivers need to fill in the clock names and device names for the clocks
 * they need to control.
 */
static struct clk_lookup msm_clocks_8916[] = {
	CLK_DUMMY("core_clk",	SDC1_CLK,	"msm_sdcc.1", OFF),
	CLK_DUMMY("iface_clk",	SDC1_P_CLK,	"msm_sdcc.1", OFF),
	CLK_DUMMY("core_clk",	SDC2_CLK,	"msm_sdcc.2", OFF),
	CLK_DUMMY("iface_clk",	SDC2_P_CLK,	"msm_sdcc.2", OFF),
	CLK_DUMMY("core_clk",   BLSP1_UART_CLK, "78af000.serial", OFF),
	CLK_DUMMY("iface_clk",  BLSP1_UART_CLK, "78af000.serial", OFF),
	CLK_DUMMY("dfab_clk",   DFAB_CLK,       "msm_sps", OFF),
	CLK_DUMMY("",	camss_ahb_clk_src.c,	"", OFF),
	CLK_DUMMY("",	csi0_clk_src.c,	"", OFF),
	CLK_DUMMY("",	csi1_clk_src.c,	"", OFF),
	CLK_DUMMY("",	ahbfabric_clk_src.c,	"", OFF),
	CLK_DUMMY("",	apss_ahb_clk_src.c,	"", OFF),
	CLK_DUMMY("",	gcc_ultaudio_xo_clk_src.c,	"", OFF),
	CLK_DUMMY("",	vfe0_clk_src.c,	"", OFF),
	CLK_DUMMY("",	mdp_clk_src.c,	"", OFF),
	CLK_DUMMY("",	gfx3d_clk_src.c,	"", OFF),
	CLK_DUMMY("",	crypto_clk_src.c,	"", OFF),
	CLK_DUMMY("",	codec_digcodec_clk_src.c,	"", OFF),
	CLK_DUMMY("",	blsp1_qup1_i2c_apps_clk_src.c,	"", OFF),
	CLK_DUMMY("",	blsp1_qup1_spi_apps_clk_src.c,	"", OFF),
	CLK_DUMMY("",	blsp1_qup2_i2c_apps_clk_src.c,	"", OFF),
	CLK_DUMMY("",	blsp1_qup2_spi_apps_clk_src.c,	"", OFF),
	CLK_DUMMY("",	blsp1_qup3_i2c_apps_clk_src.c,	"", OFF),
	CLK_DUMMY("",	blsp1_qup3_spi_apps_clk_src.c,	"", OFF),
	CLK_DUMMY("",	blsp1_qup4_i2c_apps_clk_src.c,	"", OFF),
	CLK_DUMMY("",	blsp1_qup4_spi_apps_clk_src.c,	"", OFF),
	CLK_DUMMY("",	blsp1_qup5_i2c_apps_clk_src.c,	"", OFF),
	CLK_DUMMY("",	blsp1_qup5_spi_apps_clk_src.c,	"", OFF),
	CLK_DUMMY("",	blsp1_qup6_i2c_apps_clk_src.c,	"", OFF),
	CLK_DUMMY("",	blsp1_qup6_spi_apps_clk_src.c,	"", OFF),
	CLK_DUMMY("",	blsp1_uart1_apps_clk_src.c,	"", OFF),
	CLK_DUMMY("",	blsp1_uart2_apps_clk_src.c,	"", OFF),
	CLK_DUMMY("",	blsp1_uart3_apps_clk_src.c,	"", OFF),
	CLK_DUMMY("",	blsp1_uart4_apps_clk_src.c,	"", OFF),
	CLK_DUMMY("",	blsp1_uart5_apps_clk_src.c,	"", OFF),
	CLK_DUMMY("",	blsp1_uart6_apps_clk_src.c,	"", OFF),
	CLK_DUMMY("",	cci_clk_src.c,	"", OFF),
	CLK_DUMMY("",	camss_gp0_clk_src.c,	"", OFF),
	CLK_DUMMY("",	camss_gp1_clk_src.c,	"", OFF),
	CLK_DUMMY("",	jpeg0_clk_src.c,	"", OFF),
	CLK_DUMMY("",	mclk0_clk_src.c,	"", OFF),
	CLK_DUMMY("",	mclk1_clk_src.c,	"", OFF),
	CLK_DUMMY("",	csi0phytimer_clk_src.c,	"", OFF),
	CLK_DUMMY("",	csi1phytimer_clk_src.c,	"", OFF),
	CLK_DUMMY("",	cpp_clk_src.c,	"", OFF),
	CLK_DUMMY("",	gp1_clk_src.c,	"", OFF),
	CLK_DUMMY("",	gp2_clk_src.c,	"", OFF),
	CLK_DUMMY("",	gp3_clk_src.c,	"", OFF),
	CLK_DUMMY("",	byte0_clk_src.c,	"", OFF),
	CLK_DUMMY("",	esc0_clk_src.c,	"", OFF),
	CLK_DUMMY("",	pclk0_clk_src.c,	"", OFF),
	CLK_DUMMY("",	vsync_clk_src.c,	"", OFF),
	CLK_DUMMY("",	pdm2_clk_src.c,	"", OFF),
	CLK_DUMMY("",	sdcc1_apps_clk_src.c,	"", OFF),
	CLK_DUMMY("",	sdcc2_apps_clk_src.c,	"", OFF),
	CLK_DUMMY("",	gcc_ultaudio_lpaif_aux_i2s_clk_src.c,	"", OFF),
	CLK_DUMMY("",	gcc_ultaudio_lpaif_pri_i2s_clk_src.c,	"", OFF),
	CLK_DUMMY("",	gcc_ultaudio_lpaif_sec_i2s_clk_src.c,	"", OFF),
	CLK_DUMMY("",	usb_hs_system_clk_src.c,	"", OFF),
	CLK_DUMMY("",	vcodec0_clk_src.c,	"", OFF),
	CLK_DUMMY("",	gcc_blsp1_ahb_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_prng_ahb_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_boot_rom_ahb_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_crypto_ahb_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_crypto_axi_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_crypto_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_gfx_tbu_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_gtcu_ahb_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_jpeg_tbu_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_mdp_tbu_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_pronto_tbu_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_smmu_cfg_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_venus_tbu_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_vfe_tbu_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_ultaudio_ahbfabric_ixfabric_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_ultaudio_ahbfabric_ixfabric_lpm_clk.c, "", OFF),
	CLK_DUMMY("",	gcc_ultaudio_pcnoc_mport_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_ultaudio_pcnoc_sway_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_ultaudio_avsync_xo_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_ultaudio_stc_xo_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_codec_digcodec_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_blsp1_qup1_i2c_apps_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_blsp1_qup1_spi_apps_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_blsp1_qup2_i2c_apps_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_blsp1_qup2_spi_apps_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_blsp1_qup3_i2c_apps_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_blsp1_qup3_spi_apps_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_blsp1_qup4_i2c_apps_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_blsp1_qup4_spi_apps_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_blsp1_qup5_i2c_apps_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_blsp1_qup5_spi_apps_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_blsp1_qup6_i2c_apps_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_blsp1_qup6_spi_apps_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_blsp1_uart1_apps_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_blsp1_uart2_apps_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_blsp1_uart3_apps_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_blsp1_uart4_apps_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_blsp1_uart5_apps_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_blsp1_uart6_apps_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_camss_cci_ahb_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_camss_cci_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_camss_csi0_ahb_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_camss_csi0_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_camss_csi0phy_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_camss_csi0pix_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_camss_csi0rdi_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_camss_csi1_ahb_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_camss_csi1_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_camss_csi1phy_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_camss_csi1pix_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_camss_csi1rdi_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_camss_csi_vfe0_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_camss_gp0_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_camss_gp1_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_camss_ispif_ahb_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_camss_jpeg0_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_camss_jpeg_ahb_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_camss_jpeg_axi_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_camss_mclk0_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_camss_mclk1_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_camss_micro_ahb_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_camss_csi0phytimer_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_camss_csi1phytimer_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_camss_ahb_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_camss_top_ahb_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_camss_cpp_ahb_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_camss_cpp_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_camss_vfe0_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_camss_vfe_ahb_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_camss_vfe_axi_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_spdm_csi0_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_spdm_gfx3d_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_spdm_jpeg0_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_spdm_mdp_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_spdm_pclk0_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_spdm_vcodec0_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_spdm_vfe0_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_oxili_gmem_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_gp1_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_gp2_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_gp3_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_mdss_ahb_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_mdss_axi_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_mdss_byte0_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_mdss_esc0_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_mdss_mdp_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_mdss_mdp_lut_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_mdss_pclk0_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_mdss_vsync_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_mss_cfg_ahb_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_mss_q6_bimc_axi_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_bimc_gfx_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_oxili_ahb_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_oxili_gfx3d_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_pdm2_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_pdm_ahb_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_sdcc1_ahb_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_sdcc1_apps_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_sdcc2_ahb_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_sdcc2_apps_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_ultaudio_ahbfabric_efabric_spdm_clk.c, "", OFF),
	CLK_DUMMY("",	gcc_ultaudio_lpaif_aux_i2s_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_ultaudio_lpaif_pri_i2s_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_ultaudio_lpaif_sec_i2s_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_usb2a_phy_sleep_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_usb_hs_ahb_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_usb_hs_system_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_venus0_ahb_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_venus0_axi_clk.c,	"", OFF),
	CLK_DUMMY("",	gcc_venus0_vcodec0_clk.c,	"", OFF),
	CLK_DUMMY("core_clk",	NULL, "1f00000.qcom,iommu", OFF),
	CLK_DUMMY("iface_clk",	NULL, "1f00000.qcom,iommu", OFF),
	CLK_DUMMY("core_clk",	NULL, "1e00000.qcom,iommu", OFF),
	CLK_DUMMY("iface_clk",	NULL, "1e00000.qcom,iommu", OFF),

	/* HSUSB-OTG Clocks */
	CLK_DUMMY("xo", NULL, "78d9000.usb", OFF),
	CLK_DUMMY("iface_clk", NULL, "78d9000.usb", OFF),
	CLK_DUMMY("core_clk", NULL, "78d9000.usb", OFF),
	CLK_DUMMY("sleep_clk", NULL, "78d9000.usb", OFF),

	/* CoreSight clocks */
	CLK_DUMMY("core_clk", qdss_clk.c, "826000.tmc", OFF),
	CLK_DUMMY("core_clk", qdss_clk.c, "824000.replicator", OFF),
	CLK_DUMMY("core_clk", qdss_clk.c, "825000.tmc", OFF),
	CLK_DUMMY("core_clk", qdss_clk.c, "821000.funnel", OFF),
	CLK_DUMMY("core_clk", qdss_clk.c, "841000.funnel", OFF),
	CLK_DUMMY("core_clk", qdss_clk.c, "802000.stm", OFF),
	CLK_DUMMY("core_clk", qdss_clk.c, "810000.cti", OFF),
	CLK_DUMMY("core_clk", qdss_clk.c, "811000.cti", OFF),
	CLK_DUMMY("core_clk", qdss_clk.c, "812000.cti", OFF),
	CLK_DUMMY("core_clk", qdss_clk.c, "813000.cti", OFF),
	CLK_DUMMY("core_clk", qdss_clk.c, "814000.cti", OFF),
	CLK_DUMMY("core_clk", qdss_clk.c, "815000.cti", OFF),
	CLK_DUMMY("core_clk", qdss_clk.c, "816000.cti", OFF),
	CLK_DUMMY("core_clk", qdss_clk.c, "817000.cti", OFF),
	CLK_DUMMY("core_clk", qdss_clk.c, "818000.cti", OFF),
	CLK_DUMMY("core_clk", qdss_clk.c, "858000.cti", OFF),
	CLK_DUMMY("core_clk", qdss_clk.c, "859000.cti", OFF),
	CLK_DUMMY("core_clk", qdss_clk.c, "85a000.cti", OFF),
	CLK_DUMMY("core_clk", qdss_clk.c, "85b000.cti", OFF),
	CLK_DUMMY("core_clk", qdss_clk.c, "830000.cti", OFF),
	CLK_DUMMY("core_clk", qdss_clk.c, "835000.cti", OFF),
	CLK_DUMMY("core_clk", qdss_clk.c, "838000.cti", OFF),
	CLK_DUMMY("core_clk", qdss_clk.c, "83c000.cti", OFF),

	CLK_DUMMY("core_a_clk", qdss_a_clk.c, "826000.tmc", OFF),
	CLK_DUMMY("core_a_clk", qdss_a_clk.c, "824000.replicator", OFF),
	CLK_DUMMY("core_a_clk", qdss_a_clk.c, "825000.tmc", OFF),
	CLK_DUMMY("core_a_clk", qdss_a_clk.c, "821000.funnel", OFF),
	CLK_DUMMY("core_a_clk", qdss_a_clk.c, "841000.funnel", OFF),
	CLK_DUMMY("core_a_clk", qdss_a_clk.c, "802000.stm", OFF),
	CLK_DUMMY("core_a_clk", qdss_a_clk.c, "802000.stm", OFF),
	CLK_DUMMY("core_a_clk", qdss_a_clk.c, "810000.cti", OFF),
	CLK_DUMMY("core_a_clk", qdss_a_clk.c, "811000.cti", OFF),
	CLK_DUMMY("core_a_clk", qdss_a_clk.c, "812000.cti", OFF),
	CLK_DUMMY("core_a_clk", qdss_a_clk.c, "813000.cti", OFF),
	CLK_DUMMY("core_a_clk", qdss_a_clk.c, "814000.cti", OFF),
	CLK_DUMMY("core_a_clk", qdss_a_clk.c, "815000.cti", OFF),
	CLK_DUMMY("core_a_clk", qdss_a_clk.c, "816000.cti", OFF),
	CLK_DUMMY("core_a_clk", qdss_a_clk.c, "817000.cti", OFF),
	CLK_DUMMY("core_a_clk", qdss_a_clk.c, "818000.cti", OFF),
	CLK_DUMMY("core_a_clk", qdss_a_clk.c, "858000.cti", OFF),
	CLK_DUMMY("core_a_clk", qdss_a_clk.c, "859000.cti", OFF),
	CLK_DUMMY("core_a_clk", qdss_a_clk.c, "85a000.cti", OFF),
	CLK_DUMMY("core_a_clk", qdss_a_clk.c, "85b000.cti", OFF),
	CLK_DUMMY("core_a_clk", qdss_a_clk.c, "830000.cti", OFF),
	CLK_DUMMY("core_a_clk", qdss_a_clk.c, "835000.cti", OFF),
	CLK_DUMMY("core_a_clk", qdss_a_clk.c, "838000.cti", OFF),
	CLK_DUMMY("core_a_clk", qdss_a_clk.c, "83c000.cti", OFF),

};

struct clock_init_data msm8916_clock_init_data __initdata = {
	.table = msm_clocks_8916,
	.size = ARRAY_SIZE(msm_clocks_8916),
};
